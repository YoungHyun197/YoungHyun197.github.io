---
title : "$4-3. 신경망 학습 (수치 미분)"
category :
    - mit
tag :
    - depp_learning
    - machine_learning
    - computer vision
toc : true
toc_sticky: true
comments: true
---

수치미분에 대하여 알아보자

# 수치 미분

미분은 "특정 순간"의 변화량을 뜻한다.

![](/assets/image/2022-02-16-18-08-39.png). 



x의 작은 변화가 함수 f(x)를 얼마나 변화시키느냐를 의미한다. 

이때 시간의 작은 변화, 즉 시간을 뜻하는 h를 한없이 0에 가깝게 한다는 의미로 

lim(h->0)을 사용.


``` python
# 나쁜 구현 예
def numerical_diff(f, x):
	h = 10e-50
    return (f(x+h)-f(x))/ h
```

얼핏 보면 위 함수는 문제가 없어 보이지만, 개선해야 할 점이 두 개 있다.

h에 가급적 작은 값을 대입하고 싶었기에 10e-50이라는 값을 사용했지만,

이 방식은 반올림 오차(ronding error) 문제를 일으킨다. 

반올림 오차는 작은 값이 생략되어

최종 계산 결과에 오차가 생기게 한다. 

```
np.float(1e-50)
0.0
```

위와 같이 1e-50은 float32형으로 나타내면 0.0이 되어 올바로 표현할 수 없다.

여기가 첫 번째 개선 포인트이다.

이 미세한 값 h로 1e-4 정도의 값을 사용하면 좋은 결과를 얻는다고 알려져 있다.

두 번째 개선은 함수 f의 차분(임의 두 점에서의 함숫값들의 차이)과 관련한 것이다.

x+h와 x 사이의 함수 f의 차분을 계산하고 있지만, 

진정한 미분은 x위치의 함수의 기울기에 해당한다.

하지만 이번 구현에서의 미분은 (x+h)와 x 사이의 기울기에 해당한다.

이 차이는 h를 무한히 0으로 좁히는 것이 불가능해 생기는 한계이다.

![](/assets/image/2022-02-16-18-10-35.png)


 위와 같이 수치 미분에는 오차가 포함된다.

이 오차를 줄이기 위해 (x+h)와 (x-h) 일 때의 함수 f의 차분을 계산하는 방법을 쓰기도 한다.

이 차분은 x를 중심으로 그 전후의 차분을 계산한다는 의미에서 **중심 차분** 혹은 **중앙 차분이라** 한다.

(x+h)와 x의 차분은 **전방 차분**이라 한다.

두 개선점을 적용해 수치 미분을 다시 구현해보자.

``` python
def numerical_diff(f, x):
	h = 1e-4 #0.0001
    return (f(x+h)-f(x-h)) / (2*h)
```

위와 같이 아주 작은 차분으로 미분하는 것을 **수치 미분**이라 한다.

수치 미분을 사용하여 다음 함수를 미분해보자.

 y = 0.01x2 \+ 0.1x

``` python
def function_1(x):
	return 0.01*x**2 + 0.1*x

import numpy as np
import matplotli.pylab as plt

x = np.arange(0.0, 20.0, 0.1)
# 0 에서 20까지 0.1 간격의 배열 x를 만든다. (20은 미포함)
y = function_1(x)
plt.xlabel("x")
plt.ylabel("f(x)")
plt.plot(x, y)
plt.show()
```

![](/assets/image/2022-02-16-18-11-21.png)

이렇게 계산한 미분 값이 x에 대한 f(x)의 변화량이다. 

즉, 함수의 기울기에 해당한다.

또한 y = 0.01x 2  + 0.1x의 해석적 해는 df(x)/dx = 0.02x +0.1 이다.

그래서 x가 5와 10일 때의 "진정한 미분" 은 차례로 0.2와 0.3 이다.

 앞의 수치 미분과 결과를 비교하면

그 오차가 매우 작음을 알 수 있다. 

앞에서 구한 수치 미분 값을 기울기로 하는 직선을 그려보면 아래 그림과 같이 되어,

함수의 접선에 해당하는 것을 확인할 수 있다.

![](/assets/image/2022-02-16-18-11-46.png)


# 편미분

이번에는 아래 함수를 살펴보자. 

f(x0, x1) = x02 + x12 

이 식을 파이썬으로 나타내면 아래와 같다. 

``` python
def function_2(x):
	return x[0]**2 + x[1]**2
    # 또는 return np.sum(x**2)
```

이 코드는 넘 파이 배열의 각 원소를 제곱하고 그 합을 구하는 간단한 구현이다. 

그래프로 그려보면 다음과 같다.

![](/assets/image/2022-02-16-18-13-13.png)

 위 식을 미분하면 변수가 2개임에 주의해야 한다.

그래서 "어느 변수에 대한 미분이냐", 

즉 x0와 x1 중 어느 변수에 대한 미분이냐를 구별해야 한다.

이와 같이 변수가 여럿인 함수에 대한 미분을 **편미분이라고** 한다.

수식으로는 아래와 같이 쓴다.

![](/assets/image/2022-02-16-18-13-43.png)

```python
# x0 = 3, x1 = 4 일 때, x0에 대한 편미분을 구하는 식
def function_tmp1(x0):
	return x0 * x0 + 4.0 ** 2.0

numercial_diff(function_tmp2, 4.0)
6.0000000000000000378


# x0 = 3, x1 = 4 일 때, x1에 대한 편미분을 구하는 식
def function_tmp2(x1):
	return 3.0 ** 2.0 + x1*x1
    
numercial_diff(function_tmp2, 4.0)
7.9999999999999999119
```

문제 1에서는 x1 =4로 고정된 새로운 함수를 정의하고 변수 x0에 하나뿐인 함수에 대해 

수치 치분 함수를 적용

이 처럼 **편미분은 변수가 하나인 미분과 마찬가지로 특정 장소의 기울기를 구한다.**

단, 여러 변수 중 목표 변수 하나에 초점을 맞추고 다른 변수는 값을 고정한다.

# 요약

-   미분은 "특정 순간"의 변화량을 의미한다.
-   아주 작은 값을 주었을 때의 **차분으로 미분하는 것을 수치 미분**이라고 한다.
-    (x+h)와 (x-h) 일 때의 함수 f의 차분을 계산하는 것을 **중심 차분** 혹은 **중앙 차분이라고** 한다.
-   (x+h)와 x의 차분은 **전방 차분**이라 한다.
-   **변수가 여럿인 함수에 대한 미분**을 **편미분**이라고 한다.
-   편미분은 변수가 하나인 함수를 정의하고, 그 함수를 미분하는 형태로 구현하여 풀 수 있다.
